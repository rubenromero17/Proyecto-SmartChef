<ion-content class="fondo-principal">
  <div class="contenedor-principal">

    <div class="cabecera">
      <img src="assets/icon/logoSmartChef.png" alt="Logo" class="logo">

      <div class="buscador-animado" [class.activo]="busquedaActiva">
        <ion-icon
          name="search-outline"
          class="icono-buscar"
          (click)="toggleBusqueda()">
        </ion-icon>

        <ion-input
          type="text"
          placeholder="Buscar receta..."
          class="campo-busqueda">
        </ion-input>
      </div>

      <button class="boton-filtro" (click)="filtroActivo = !filtroActivo">
        <ion-icon name="options-outline"></ion-icon> Filtro
      </button>


      <div class="panel-filtro" *ngIf="filtroActivo">
        <div class="categorias">
          <label><input type="checkbox" [(ngModel)]="filtro.economica"> Económica</label>
          <label><input type="checkbox" [(ngModel)]="filtro.vegetariana"> Vegetariana</label>
          <label><input type="checkbox" [(ngModel)]="filtro.sin_gluten"> Sin gluten</label>
          <label><input type="checkbox" [(ngModel)]="filtro.rapido"> Rápido</label>
        </div>

        <div class="ingredientes-filtro">
          <ion-input placeholder="Añadir ingrediente" [(ngModel)]="ingredienteFiltro"></ion-input>
          <ion-button (click)="agregarIngredienteFiltro()">Añadir</ion-button>
        </div>

        <div class="ingredientes-agregados">
      <span class="ingrediente-chip" *ngFor="let ing of filtro.ingredientes; let i = index">
        {{ ing }} <button (click)="quitarIngredienteFiltro(i)">×</button>
      </span>
        </div>

        <button class="boton-aplicar" (click)="aplicarFiltro()">Aplicar filtro</button>
      </div>
    </div>

    <app-tarjeta-recetas [recetas]="recetas"
    (eliminar)="borrarReceta($event)" (editar)="abrirFormularioParaEditarPorId($event)">
    </app-tarjeta-recetas>



    <div class="panel-filtro" *ngIf="filtroActivo">

    </div>

    <div class="boton-anadir-receta" (click)="mostrarFormulario = !mostrarFormulario">
      <ion-icon name="add-outline"></ion-icon>
      <button type="submit">
      {{ nuevaReceta.id !== 0 ? 'Actualizar Receta' : 'Crear Receta' }}
    </button>
    </div>


    <div *ngIf="mostrarFormulario" class="formulario-receta">
      <form (ngSubmit)="guardarReceta()">

        <label for="nombre">Nombre:</label>
        <input id="nombre" [(ngModel)]="nuevaReceta.nombre" name="nombre" required />

        <label for="descripcion">Descripción:</label>
        <textarea id="descripcion" [(ngModel)]="nuevaReceta.descripcion" name="descripcion" required></textarea>

        <label for="tiempoPreparacion">Tiempo de preparación (min):</label>
        <input type="number" id="tiempoPreparacion" [(ngModel)]="nuevaReceta.tiempoPreparacion" name="tiempoPreparacion" min="1" required />

        <label for="urlImagen">URL Imagen:</label>
        <input id="urlImagen" [(ngModel)]="nuevaReceta.urlImagen" name="urlImagen" />

        <label for="dificultad">Dificultad:</label>
        <select id="dificultad" [(ngModel)]="nuevaReceta.dificultad" name="dificultad" required>
          <option value="FACIL">Fácil</option>
          <option value="MEDIA">Media</option>
          <option value="DIFICIL">Difícil</option>
        </select>

        <label>
          <input type="checkbox" [(ngModel)]="nuevaReceta.economica" name="economica" /> Económica
        </label>
        <label>
          <input type="checkbox" [(ngModel)]="nuevaReceta.vegetariana" name="vegetariana" /> Vegetariana
        </label>
        <label>
          <input type="checkbox" [(ngModel)]="nuevaReceta.sin_gluten" name="sin_gluten" /> Sin gluten
        </label>
        <label>
          <input type="checkbox" [(ngModel)]="nuevaReceta.rapido" name="rapido" /> Rápido
        </label>


        <h3>Ingredientes</h3>
        <div *ngFor="let ing of nuevaReceta.ingredientes; let i = index">
          <input placeholder="Nombre" [(ngModel)]="nuevaReceta.ingredientes[i].nombre" name="ingredienteNombre{{i}}" required />
          <input type="number" placeholder="Cantidad" [(ngModel)]="nuevaReceta.ingredientes[i].cantidad" name="ingredienteCantidad{{i}}" min="1" required />
          <button type="button" (click)="eliminarIngrediente(i)">Eliminar</button>
        </div>
        <button type="button" (click)="agregarIngrediente()">Añadir Ingrediente</button>


        <h3>Instrucciones</h3>
        <div *ngFor="let instr of nuevaReceta.instrucciones; let j = index">
          <textarea placeholder="Descripción" [(ngModel)]="nuevaReceta.instrucciones[j].descripcion" name="instrDescripcion{{j}}" required></textarea>
          <button type="button" (click)="eliminarInstruccion(j)">Eliminar</button>
        </div>
        <button type="button" (click)="agregarInstruccion()">Añadir Instrucción</button>

        <br /><br />
        <button type="submit">Confirmar</button>
      </form>
    </div>
  </div>

  <app-barra-navegacion></app-barra-navegacion>
</ion-content>
